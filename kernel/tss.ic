; tree/kernel/tss.ic
; Author: hyan23
; Date: 2016.07.02
;

%ifndef _TSS_IC_
%define _TSS_IC_


; 任务状态段格式:
; ------------------------------------------------------------
;  31                         15                            0 |
; ------------------------------------------------------------
;         IO映射基地址           |             (保留)       |T |
; ------------------------------------------------------------
;            (保留)            |         LDT 段选择子          |
; ------------------------------------------------------------
;            (保留)            |              GS              |
; ------------------------------------------------------------
;            (保留)            |              FS              |
; ------------------------------------------------------------
;            (保留)            |              DS              |
; ------------------------------------------------------------
;            (保留)            |              SS              |
; -------------------------------------------------------------
;            (保留)            |              CS              |
; ------------------------------------------------------------
;            (保留)            |              ES              |
; -------------------------------------------------------------
;                             EDI                              |
; -------------------------------------------------------------
;                             ESI                              |
; -------------------------------------------------------------
;                             EBP                              |
; -------------------------------------------------------------
;                             ESP                              |
; -------------------------------------------------------------
;                             EBX                              |
; -------------------------------------------------------------
;                             EDX                              |
; -------------------------------------------------------------
;                             ECX                              |
; -------------------------------------------------------------
;                             EAX                              |
; -------------------------------------------------------------
;                            EFLAGS                            |
; -------------------------------------------------------------
;                             EIP                              |
; -------------------------------------------------------------
;                         CR3(PDBR)                           |
; -------------------------------------------------------------
;            (保留)             |            SS2               |
; -------------------------------------------------------------
;                             ESP2                             |
; -------------------------------------------------------------
;            (保留)             |            SS1               |
; -------------------------------------------------------------
;                             ESP1                             |
; -------------------------------------------------------------
;            (保留)             |            SS0               |
; -------------------------------------------------------------
;                             ESP0                            |
; -------------------------------------------------------------
;            (保留)             |     前一个任务的指针(TSS)      |
; -------------------------------------------------------------


; 任务状态段数据结构:
    TREE_TSS_LAST_TSS_SEL_OFS           EQU        0
    TREE_TSS_ESP0_POINTER_OFS           EQU        4
    TREE_TSS_SS0_SEL_OFS                EQU        8
    TREE_TSS_ESP1_POINTER_OFS           EQU        12
    TREE_TSS_SS1_SEL_OFS                EQU        16
    TREE_TSS_ESP2_POINTER_OFS           EQU        20
    TREE_TSS_SS2_SEL_OFS                EQU        24
    TREE_TSS_REGISTER_CR3_OFS           EQU        28
    TREE_TSS_REGISTER_EIP_OFS           EQU        32
    TREE_TSS_REGISTER_EFLAGS_OFS        EQU        36
    TREE_TSS_REGISTER_EAX_OFS           EQU        40
    TREE_TSS_REGISTER_ECX_OFS           EQU        44
    TREE_TSS_REGISTER_EDX_OFS           EQU        48
    TREE_TSS_REGISTER_EBX_OFS           EQU        52
    TREE_TSS_REGISTER_ESP_OFS           EQU        56
    TREE_TSS_REGISTER_EBP_OFS           EQU        60
    TREE_TSS_REGISTER_ESI_OFS           EQU        64
    TREE_TSS_REGISTER_EDI_OFS           EQU        68
    TREE_TSS_SEGSEL_ES_OFS              EQU        72
    TREE_TSS_SEGSEL_CS_OFS              EQU        76
    TREE_TSS_SEGSEL_SS_OFS              EQU        80
    TREE_TSS_SEGSEL_DS_OFS              EQU        84
    TREE_TSS_SEGSEL_FS_OFS              EQU        88
    TREE_TSS_SEGSEL_GS_OFS              EQU        92
    TREE_TSS_LDT_SEL_OFS                EQU        96
    TREE_TSS_DEBUG_BIT_T_OFS            EQU        100
    TREE_TSS_IOPBS_BASE_OFS             EQU        102

    TREE_TSS_MINIMUM_BYTES              EQU        104

                                    ; 任务标志寄存器默认值在通过时钟中断使用
                                    ; jmp实现任务切换的多任务系统中, 十分重要,
                                    ; 因中断时处理器会自动清除EFLAGS的ti位以禁止
                                    ; 嵌套中断,所以任务tss的EFLAGS域的ti位
                                    ; 必须置'1', 否则任务一经切换,处理器不会再次
                                    ; 理会时钟中断。
    TREE_TSS_BUILT_EFLAGS               EQU         0x246

%endif ; _TSS_IC_